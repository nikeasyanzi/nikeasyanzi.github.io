<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>System Log Collection With Grafana Loki and Alloy | Craig Yang's Dev Blog</title><meta name=keywords content="Observibility"><meta name=description content="Introduction
In this article, we demonstrate how to effectively collecting logs with Alloy and Loki.
With that, telemetry signals from applications, infrastructures are exported to on place for future telemetry.
In the lab exercise, we try to setup a Nginx service along with Loki, Alloy, and observe the system log on Grafana.
Configuration deep dive
Grafana Alloy configuration
A configuration file config.alloy is used, that contains logs to collect and where to forward them to."><meta name=author content="4rkal"><link rel=canonical href=https://nikeasyanzi.github.io/posts/system-log-collection-with-grafana-loki-and-alloy/><link crossorigin=anonymous href=/assets/css/stylesheet.min.24117e94f7185554bf370e131546657a05d72834bf02c67c2a4215d5cf110a80.css integrity="sha256-JBF+lPcYVVS/Nw4TFUZlegXXKDS/AsZ8KkIV1c8RCoA=" rel="preload stylesheet" as=style><link rel=icon href=https://nikeasyanzi.github.io/4rkal.png><link rel=apple-touch-icon href=https://nikeasyanzi.github.io/apple-touch-icon.png><link rel=alternate hreflang=en href=https://nikeasyanzi.github.io/posts/system-log-collection-with-grafana-loki-and-alloy/><meta name=twitter:card content="summary"><meta name=twitter:title content="System Log Collection With Grafana Loki and Alloy | Craig Yang's Dev Blog"><meta name=twitter:description content="Introduction
In this article, we demonstrate how to effectively collecting logs with Alloy and Loki.
With that, telemetry signals from applications, infrastructures are exported to on place for future telemetry.
In the lab exercise, we try to setup a Nginx service along with Loki, Alloy, and observe the system log on Grafana.
Configuration deep dive
Grafana Alloy configuration
A configuration file config.alloy is used, that contains logs to collect and where to forward them to."><meta property="og:title" content="System Log Collection With Grafana Loki and Alloy | Craig Yang's Dev Blog"><meta property="og:description" content="Introduction
In this article, we demonstrate how to effectively collecting logs with Alloy and Loki.
With that, telemetry signals from applications, infrastructures are exported to on place for future telemetry.
In the lab exercise, we try to setup a Nginx service along with Loki, Alloy, and observe the system log on Grafana.
Configuration deep dive
Grafana Alloy configuration
A configuration file config.alloy is used, that contains logs to collect and where to forward them to."><meta property="og:type" content="article"><meta property="og:url" content="https://nikeasyanzi.github.io/posts/system-log-collection-with-grafana-loki-and-alloy/"><meta property="og:image" content="https://nikeasyanzi.github.io/4rkal.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-18T23:33:17+08:00"><meta property="article:modified_time" content="2025-10-18T23:33:17+08:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://nikeasyanzi.github.io/posts/"},{"@type":"ListItem","position":2,"name":"System Log Collection With Grafana Loki and Alloy","item":"https://nikeasyanzi.github.io/posts/system-log-collection-with-grafana-loki-and-alloy/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"System Log Collection With Grafana Loki and Alloy | Craig Yang's Dev Blog","name":"System Log Collection With Grafana Loki and Alloy","description":"Introduction In this article, we demonstrate how to effectively collecting logs with Alloy and Loki. With that, telemetry signals from applications, infrastructures are exported to on place for future telemetry.\nIn the lab exercise, we try to setup a Nginx service along with Loki, Alloy, and observe the system log on Grafana.\nConfiguration deep dive Grafana Alloy configuration A configuration file config.alloy is used, that contains logs to collect and where to forward them to.\n","keywords":["Observibility"],"wordCount":"724","inLanguage":"en","datePublished":"2025-10-18T23:33:17+08:00","dateModified":"2025-10-18T23:33:17+08:00","author":{"@type":"Person","name":"4rkal"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://nikeasyanzi.github.io/posts/system-log-collection-with-grafana-loki-and-alloy/"},"publisher":{"@type":"Organization","name":"Craig Yang's Dev Blog","logo":{"@type":"ImageObject","url":"https://nikeasyanzi.github.io/4rkal.png"}}}</script><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript></head><body class="dark type-posts kind-page layout-" id=top><script data-no-instant>function switchTheme(e){switch(e){case"light":document.body.classList.remove("dark");break;case"dark":document.body.classList.add("dark");break;default:window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")}}function isDarkTheme(){return document.body.className.includes("dark")}function getPrefTheme(){return localStorage.getItem("pref-theme")}function setPrefTheme(e){switchTheme(e),localStorage.setItem("pref-theme",e)}const toggleThemeCallbacks={};toggleThemeCallbacks.main=e=>{setPrefTheme(e?"light":"dark")},window.addEventListener("toggle-theme",function(){const e=isDarkTheme();for(const t in toggleThemeCallbacks)toggleThemeCallbacks[t](e)});function toggleThemeListener(){window.dispatchEvent(new CustomEvent("toggle-theme"))}</script><script>(function(){const t="dark",e=getPrefTheme(),n=e||t;switchTheme(n)})()</script><header class=header><nav class=nav><div class=logo><a href=https://nikeasyanzi.github.io/ accesskey=h title="Craig Yang's Dev Blog (Alt + H)">Craig Yang's Dev Blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://nikeasyanzi.github.io/posts/ title=Posts class=active>üìö Posts</a></li><li><a href=https://nikeasyanzi.github.io/search/ title="Search the site (Alt + /)" data-no-instant accesskey=/>üîç Search</a></li><li><a href=https://nikeasyanzi.github.io/archives/ title="üóÇÔ∏è archives">üóÇÔ∏è archives</a></li><li><a href=https://nikeasyanzi.github.io/about/ title=About>üòé About</a></li></ul></nav></header><main class="main post"><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://nikeasyanzi.github.io/>Home</a>&nbsp;¬ª&nbsp;<a href=https://nikeasyanzi.github.io/posts/>Posts</a></div><h1 class=post-title>System Log Collection With Grafana Loki and Alloy</h1><div class=post-meta><span class=meta-item><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar" style="user-select:text"><rect x="3" y="4" width="18" height="18" rx="2" ry="2" style="user-select:text"/><line x1="16" y1="2" x2="16" y2="6" style="user-select:text"/><line x1="8" y1="2" x2="8" y2="6" style="user-select:text"/><line x1="3" y1="10" x2="21" y2="10" style="user-select:text"/></svg>
<span>2025-10-18</span></span><span class=meta-item>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon" style="user-select:text"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z" style="user-select:text"/><line x1="7" y1="7" x2="7" y2="7" style="user-select:text"/></svg>
<span class=post-tags><a href=https://nikeasyanzi.github.io/tags/observibility/>Observibility</a></span></span><span class=meta-item>
<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="user-select:text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z" style="user-select:text"/><polyline points="14 2 14 8 20 8" style="user-select:text"/><line x1="16" y1="13" x2="8" y2="13" style="user-select:text"/><line x1="16" y1="17" x2="8" y2="17" style="user-select:text"/><polyline points="10 9 9 9 8 9" style="user-select:text"/></svg>
<span>724 words</span></span><span class=meta-item>
<svg width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>2 min</span></span></div></header><div class="toc side right"><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#introduction aria-label=Introduction>Introduction</a></li><li><a href=#configuration-deep-dive aria-label="Configuration deep dive">Configuration deep dive</a><ul><li><a href=#grafana-alloy-configuration aria-label="Grafana Alloy configuration">Grafana Alloy configuration</a></li><li><a href=#loki-configuration aria-label="Loki Configuration">Loki Configuration</a></li><li><a href=#grafana-loki-data-source aria-label="Grafana Loki Data source">Grafana Loki Data source</a></li></ul></li><li><a href=#lab-exercise aria-label="Lab exercise">Lab exercise</a><ul><li><a href=#starting-the-service aria-label="Starting the service">Starting the service</a></li><li><a href=#check-logs-of-our-services aria-label="Check logs of our services">Check logs of our services</a></li><li><a href=#query-logs aria-label="Query logs">Query logs</a></li></ul></li><li><a href=#how-to-add-my-application-log-to-grafana aria-label="How to add my application log to Grafana">How to add my application log to Grafana</a></li><li><a href=#conclusion aria-label=Conclusion>Conclusion</a></li><li><a href=#reference aria-label=Reference>Reference</a></li></ul></div></details></div><div class=post-content><h1 id=introduction>Introduction<a hidden class=anchor aria-hidden=true href=#introduction>¬∂</a></h1><p>In this article, we demonstrate how to effectively collecting logs with <a href=https://github.com/grafana/alloy>Alloy</a> and <a href=https://github.com/grafana/loki>Loki</a>.
With that, telemetry signals from applications, infrastructures are exported to on place for future telemetry.</p><p>In the lab exercise, we try to setup a Nginx service along with Loki, Alloy, and observe the system log on Grafana.</p><h1 id=configuration-deep-dive>Configuration deep dive<a hidden class=anchor aria-hidden=true href=#configuration-deep-dive>¬∂</a></h1><h2 id=grafana-alloy-configuration>Grafana Alloy configuration<a hidden class=anchor aria-hidden=true href=#grafana-alloy-configuration>¬∂</a></h2><p>A configuration file <code>config.alloy</code> is used, that contains logs to collect and where to forward them to.</p><h2 id=loki-configuration>Loki Configuration<a hidden class=anchor aria-hidden=true href=#loki-configuration>¬∂</a></h2><p>Grafana Loki requires a configuration file to define how it should run. Within the loki-fundamentals directory, you will find a file called <em>loki-config.yaml</em>.</p><h2 id=grafana-loki-data-source>Grafana Loki Data source<a hidden class=anchor aria-hidden=true href=#grafana-loki-data-source>¬∂</a></h2><p>This is used by Grafana to connect to Loki and query the logs. Grafana has multiple ways to define a data source;</p><ul><li>Direct: This is where you define the data source in the Grafana UI.</li><li>Provisioning: This is where you define the data source in a configuration file and have Grafana automatically create the data source.</li><li>API: This is where you use the Grafana API to create the data source.</li></ul><p>In the following lab part, we are using the provisioning method. We have defined the data source in this portion of the docker-compose.yml file:</p><h1 id=lab-exercise>Lab exercise<a hidden class=anchor aria-hidden=true href=#lab-exercise>¬∂</a></h1><p>The full configuration and docker-compose file can be found <a href=https://github.com/nikeasyanzi/loki-alloy-Grafana>here</a>
In the repo,
<em>config.alloy</em> is the configuration file for alloy.
<em>loki-config.yam</em> is the configuration file for loki.
grafana-dashboard.json
grafana-datasources.yml defining the datasource for grafana
grafana-default.yaml
grafana-data is the folder for grafana database</p><h2 id=starting-the-service>Starting the service<a hidden class=anchor aria-hidden=true href=#starting-the-service>¬∂</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker-compose -f ./docker-compose.yml up -d
</span></span></code></pre></td></tr></table></div></div><p><img loading=lazy src=https://i.imgur.com/0U9B96d.png alt></p><p>Next, we check the service status.</p><ol><li>nginx
<a href=http://10.122.168.81:8082/stub_status>http://10.122.168.81:8082/stub_status</a></li><li>loki
¬†<a href=http://localhost:3100/metrics>http://localhost:3100/metrics</a></li><li>alloy
<a href=http://localhost:12345/>http://localhost:12345/</a></li></ol><p>When checking the alloy status, we see the loki components are up and running.
<img loading=lazy src=https://i.imgur.com/vL5XLtX.png alt></p><p>We can also navigate the Alloy UI at <a href=http://localhost:12345/graph>http://localhost:12345/graph</a> to see the configuration file <code>config.alloy</code>visually. The configuration file defines logs to collect and where to forward them to.</p><ul><li><p>discovery.docker: This component queries the metadata of the Docker environment via the Docker socket and discovers new containers, as well as providing metadata about the containers.</p></li><li><p>discovery.relabel: This component converts a metadata (__meta_docker_container_name) label into a Loki label (container).</p></li><li><p>loki.source.docker: This component collects logs from the discovered containers and forwards them to the next component. It requests the metadata from the discovery.docker component and applies the relabeling rules from the discovery.relabel component.</p></li><li><p>loki.process: This component provides stages for log transformation and extraction. In this case it adds a static label env=production to all logs.</p></li><li><p>loki.write: This component writes the logs to Loki. It forwards the logs to the Loki endpoint <a href=http://loki:3100/loki/api/v1/push>http://loki:3100/loki/api/v1/push</a>.</p></li></ul><p><img loading=lazy src=https://i.imgur.com/SR3QRQc.png alt></p><ol start=4><li>Next, we configure Grafana to visualize the data collected by loki.
<img loading=lazy src=https://i.imgur.com/ebB1Tdi.png alt></li></ol><p>Click Save&amp;test to check the connectivity.
<img loading=lazy src=https://i.imgur.com/CBBP1Pa.png alt></p><h2 id=check-logs-of-our-services>Check logs of our services<a hidden class=anchor aria-hidden=true href=#check-logs-of-our-services>¬∂</a></h2><p>Once the service is up and running, we can navigate to <a href=http://localhost:3000/drilldown>http://localhost:3000/drilldown</a>.
Select Logs. You should see the Grafana Logs Drilldown page.</p><p>We can see Alloy is able to tail the Nginx log, also other container&rsquo;s logs are also collected.
<img loading=lazy src=https://i.imgur.com/GQjy4oQ.png alt></p><h2 id=query-logs>Query logs<a hidden class=anchor aria-hidden=true href=#query-logs>¬∂</a></h2><p>To manually query Loki to ask more advanced questions about the logs, we use Grafana Explore.
Open a browser and navigate to <a href=http://localhost:3000>http://localhost:3000</a> to open Grafana.
From the Grafana main menu, click the Explore icon (1) to open the Explore tab.
Click¬†<strong>Code</strong>¬†to work in Code mode and type <strong>{container=&ldquo;nginx&rdquo;}</strong>
<img loading=lazy src=https://i.imgur.com/cj7PM4O.png alt></p><p>Also here , we keep restart the Nginx service every 30s.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=k>for</span> i in <span class=o>{</span>1..6<span class=o>}</span><span class=p>;</span> <span class=k>do</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;This is loop number </span><span class=nv>$i</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  docker restart nginx
</span></span><span class=line><span class=cl>  sleep <span class=m>30</span>
</span></span><span class=line><span class=cl><span class=k>done</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=how-to-add-my-application-log-to-grafana>How to add my application log to Grafana<a hidden class=anchor aria-hidden=true href=#how-to-add-my-application-log-to-grafana>¬∂</a></h1><p>Â¶Ç‰ΩïËá™Ë®Çapplication log Âë¢Ôºü
ÂæûÂÆòÁ∂≤Áµ¶ÁöÑ<a href=https://github.com/grafana/loki-fundamentals/tree/getting-started/greenhouse>greenhouse ÁØÑ‰æã</a>, Âú®in main_app.py, ÊàëÂÄëÁúãÂà∞</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>logging.basicConfig(
</span></span><span class=line><span class=cl>    format=&#39;ts=%(asctime)s,%(msecs)03d level=%(levelname)s line=%(lineno)d msg=&#34;%(message)s&#34;&#39;,
</span></span><span class=line><span class=cl>    datefmt=&#39;%Y-%m-%d %H:%M:%S&#39;
</span></span><span class=line><span class=cl>)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>log = logging.getLogger(&#39;werkzeug&#39;)
</span></span><span class=line><span class=cl>log.setLevel(logging.INFO)
</span></span></code></pre></td></tr></table></div></div><p>ÊâÄ‰ª•ÂÖ∂ÂØ¶ÂØ´Âà∞system log Âç≥ÂèØ</p><h1 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>¬∂</a></h1><p>This note demonstrated how to set up a log collection system using:
<strong>Grafana Alloy</strong>, <strong>Loki</strong> and <strong>Grafana</strong>.</p><ol><li>how to collect logs using <strong>Grafana Alloy</strong> and send to <strong>Loki</strong></li><li>how the collected logs been configured in <strong>Grafana</strong>.</li></ol><p>To sum up, the solution provides a way to redirect the log used to be generated at local to remote Grafana serve. That provides a unified interface.</p><h1 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>¬∂</a></h1><p><a href=https://medium.com/@venkat65534/full-stack-observability-with-grafana-prometheus-loki-tempo-and-opentelemetry-90839113d17d>https://medium.com/@venkat65534/full-stack-observability-with-grafana-prometheus-loki-tempo-and-opentelemetry-90839113d17d</a></p><p><a href=https://github.com/grafana/loki-fundamentals>https://github.com/grafana/loki-fundamentals</a></p><p><a href=https://grafana.com/docs/loki/latest/get-started/quick-start/tutorial/>https://grafana.com/docs/loki/latest/get-started/quick-start/tutorial/</a></p><p><a href=https://github.com/grafana/docker-monitor-workshop>https://github.com/grafana/docker-monitor-workshop</a></p><p><a href=https://ithelp.ithome.com.tw/articles/10335935>https://ithelp.ithome.com.tw/articles/10335935</a></p><p><a href=https://medium.com/@fawenyo/python-%E7%9B%A3%E6%8E%A7-prometheus-loki-grafana-25ead4bbb681>https://medium.com/@fawenyo/python-%E7%9B%A3%E6%8E%A7-prometheus-loki-grafana-25ead4bbb681</a></p><p><a href=https://medium.com/@derekjan1240/grafana-loki-prometheus-with-docker-compose-75d431bd07e2>https://medium.com/@derekjan1240/grafana-loki-prometheus-with-docker-compose-75d431bd07e2</a></p></div><footer class=post-footer><nav class=paginav><a class=next href=https://nikeasyanzi.github.io/posts/container-monitoring-with-cadvisor/><span class=title>Next Page&nbsp;<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right" style="user-select:text"><line x1="5" y1="12" x2="19" y2="12" style="user-select:text"/><polyline points="12 5 19 12 12 19" style="user-select:text"/></svg></span><br><span>Container Monitoring With cAdvisor</span></a></nav></footer><div class=comments-separator></div><div class=comments-box><div id=disqus_thread></div></div><script type=text/javascript>var disqus_config=function(){this.page.url="https://nikeasyanzi.github.io/posts/system-log-collection-with-grafana-loki-and-alloy/",this.page.identifier="system-log-collection-with-grafana-loki-and-alloy"};(function(){const t=window.DISQUS;if(t)t.reset({reload:!0,config:disqus_config});else{var n=document,e=n.createElement("script");e.src="//nikeasyanzi.disqus.com/embed.js",e.defer=!0,e.setAttribute("data-timestamp",+new Date),e.setAttribute("data-no-instant",""),n.head.appendChild(e)}})()</script></article></main><footer class=footer><span>&copy; 2025 <a href=https://nikeasyanzi.github.io/>Craig Yang's Dev Blog</a></span><span style=display:inline-block;margin-left:1em>
<a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA</a>
</span><span style=display:inline-block;margin-left:1em>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/reorx/hugo-PaperModX/ rel=noopener target=_blank>PaperModX</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>(function(){const t=""=="1";if(t)return;let e=document.getElementById("theme-toggle");e.removeEventListener("click",toggleThemeListener),e.addEventListener("click",toggleThemeListener)})()</script><script>(function(){let e=document.getElementById("menu");e&&(e.scrollLeft=localStorage.getItem("menu-scroll-position"),e.onscroll=function(){localStorage.setItem("menu-scroll-position",e.scrollLeft)});const t=""=="1",n=""=="1";if(window.matchMedia("(prefers-reduced-motion: reduce)").matches||t||n)return;document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})})()</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>if(window.scrollListeners)for(const e of scrollListeners)window.removeEventListener("scroll",e);window.scrollListeners=[]</script><script src=/js/medium-zoom.min.js data-no-instant></script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerText="copy";function s(){t.innerText="copied!",setTimeout(()=>{t.innerText="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script>(function(){const a="1"=="1";if(!a)return;if(!document.querySelector(".toc")){console.log("no toc found, ignore toc scroll");return}const r=window.scrollListeners,t=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id]"),n="active";let e=t[0];o(e).classList.add(n);const c=()=>{const s=[];for(const e of t)if(l(e)<5)s.push(e);else break;s.length>0?newActiveHeading=s[s.length-1]:newActiveHeading=t[0],e!=newActiveHeading&&(o(e).classList.remove(n),e=newActiveHeading,o(e).classList.add(n))};let s=null;const i=()=>{s!==null&&clearTimeout(s),s=setTimeout(c,50)};window.addEventListener("scroll",i,!1),r.push(i);function o(e){const t=encodeURI(e.getAttribute("id")).toLowerCase();return document.querySelector(`.toc ul li a[href="#${t}"]`)}function l(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect();return t.top}})()</script></body></html>